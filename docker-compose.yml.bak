version: "3.9"
name: cloud-java


services:
discovery:
build: ./discovery-server
container_name: discovery
ports:
- "8761:8761"
environment:
- SPRING_PROFILES_ACTIVE=${SPRING_PROFILES_ACTIVE}
healthcheck:
test: ["CMD", "wget", "-qO-", "http://localhost:8761/actuator/health"]
interval: 15s
timeout: 5s
retries: 10


config-server:
build: ./config-server
container_name: config-server
depends_on:
discovery:
condition: service_healthy
ports:
- "8888:8888"
environment:
- SPRING_PROFILES_ACTIVE=${SPRING_PROFILES_ACTIVE}
- EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=${EUREKA_URL}
healthcheck:
test: ["CMD", "wget", "-qO-", "http://localhost:8888/actuator/health"]
interval: 15s
timeout: 5s
retries: 10


gateway:
build: ./gateway
container_name: gateway
depends_on:
discovery:
condition: service_healthy
config-server:
condition: service_healthy
ports:
- "${GATEWAY_PORT}:8080"
environment:
- SPRING_PROFILES_ACTIVE=${SPRING_PROFILES_ACTIVE}
- EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=${EUREKA_URL}
- SPRING_CLOUD_CONFIG_URI=${CONFIG_SERVER_URL}
healthcheck:
test: ["CMD", "wget", "-qO-", "http://localhost:8080/actuator/health"]
interval: 15s
timeout: 5s
retries: 10


tasks-service:
build: ./tasks-service
container_name: tasks-service
depends_on:
discovery:
condition: service_healthy
config-server:
condition: service_healthy
gateway:
